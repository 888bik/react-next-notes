ğŸ’¡ **è€—æ—¶æ•´ç† | å…è´¹åˆ†äº«** ğŸ‘‰ [cunlove.cn](https://cunlove.cn) ğŸ’¡

# âœ…ä»‹ç»ä¸‹RabbitMQçš„äº‹åŠ¡æœºåˆ¶

# å…¸å‹å›ç­”


[âœ…å¦‚ä½•ä¿éšœæ¶ˆæ¯ä¸€å®šèƒ½å‘é€åˆ°RabbitMQ](https://www.yuque.com/hollis666/xx04wa/inmrfqk0qyvsdgg3)



æƒ³è¦ä¿è¯å‘é€è€…ä¸€å®šèƒ½æŠŠæ¶ˆæ¯å‘é€ç»™RabbitMQï¼Œä¸€ç§æ˜¯é€šè¿‡confirmæœºåˆ¶ï¼Œå¦å¤–ä¸€ç§å°±æ˜¯é€šè¿‡äº‹åŠ¡æœºåˆ¶ã€‚



RabbitMQçš„äº‹åŠ¡æœºåˆ¶ï¼Œå…è®¸ç”Ÿäº§è€…å°†ä¸€ç»„æ“ä½œæ‰“åŒ…æˆä¸€ä¸ªåŸå­äº‹åŠ¡å•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚äº‹åŠ¡æä¾›äº†ä¸€ç§ç¡®ä¿æ¶ˆæ¯å®Œæ•´æ€§çš„æ–¹æ³•ï¼Œä½†éœ€è¦è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬å¯¹æ€§èƒ½æœ‰ä¸€å®šçš„å½±å“ã€‚



RabbitMQæ˜¯åŸºäºAMQPåè®®å®ç°çš„ï¼ŒRabbitMQä¸­ï¼Œäº‹åŠ¡æ˜¯é€šè¿‡åœ¨é€šé“ï¼ˆChannelï¼‰ä¸Šå¯ç”¨çš„ï¼Œä¸äº‹åŠ¡æœºåˆ¶æœ‰å…³çš„æ–¹æ³•æœ‰ä¸‰ä¸ªï¼š

+ txSelect()ï¼šå°†å½“å‰channelè®¾ç½®æˆtransactionæ¨¡å¼ã€‚
+ txCommit()ï¼šæäº¤äº‹åŠ¡ã€‚
+ txRollback()ï¼šå›æ»šäº‹åŠ¡ã€‚



æˆ‘ä»¬éœ€è¦å…ˆé€šè¿‡txSelectå¼€å¯äº‹åŠ¡ï¼Œç„¶åå°±å¯ä»¥å‘å¸ƒæ¶ˆæ¯ç»™MQäº†ï¼Œå¦‚æœtxCommitæäº¤æˆåŠŸäº†ï¼Œåˆ™æ¶ˆæ¯ä¸€å®šåˆ°è¾¾äº†RabbitMQï¼Œå¦‚æœåœ¨txCommitæ‰§è¡Œä¹‹å‰RabbitMQå®ä¾‹å¼‚å¸¸å´©æºƒæˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥æ•è·è¿™ä¸ªå¼‚å¸¸ç„¶åæ‰§è¡ŒtxRollbackè¿›è¡Œå›æ»šäº‹åŠ¡ã€‚



æ‰€ä»¥ï¼Œ é€šè¿‡äº‹åŠ¡æœºåˆ¶ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ä¿è¯æ¶ˆæ¯ä¸€å®šå¯ä»¥å‘é€ç»™RabbitMQã€‚



ä»¥ä¸‹ï¼Œæ˜¯ä¸€ä¸ªé€šè¿‡äº‹åŠ¡å‘é€æ¶ˆæ¯çš„æ–¹æ³•ç¤ºä¾‹ï¼š



```plain
import com.rabbitmq.client.*;

public class RabbitMQTransactionExample {

    public static void main(String[] args) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost("localhost");

        try (Connection connection = factory.newConnection();
             Channel channel = connection.createChannel()) {

            // å¯ç”¨äº‹åŠ¡
            channel.txSelect();

            String exchangeName = "my_exchange";
            String routingKey = "my_routing_key";

            try {
                // å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯
                String message1 = "Transaction Message 1";
                channel.basicPublish(exchangeName, routingKey, null, message1.getBytes());

                // å‘é€ç¬¬äºŒæ¡æ¶ˆæ¯
                String message2 = "Transaction Message 2";
                channel.basicPublish(exchangeName, routingKey, null, message2.getBytes());

                // æ¨¡æ‹Ÿä¸€ä¸ªé”™è¯¯
                int x = 1 / 0;

                // æäº¤äº‹åŠ¡ï¼ˆå¦‚æœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼‰
                channel.txCommit();

                System.out.println("Transaction committed.");
            } catch (Exception e) {
                // å‘ç”Ÿé”™è¯¯ï¼Œå›æ»šäº‹åŠ¡
                channel.txRollback();
                System.err.println("Transaction rolled back.");
            }
        }
    }
}

```









> æ›´æ–°: 2024-03-04 21:41:06  
> åŸæ–‡: <https://www.yuque.com/hollis666/xx04wa/alxsh6b98sck90fu>

---
ğŸ’¡ **è€—æ—¶æ•´ç† | å…è´¹åˆ†äº«** ğŸ‘‰ [cunlove.cn](https://cunlove.cn) ğŸ’¡
